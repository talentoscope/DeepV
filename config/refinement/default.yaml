# Refinement configuration
# Magic numbers extracted from refinement code

# Rendering parameters
render_res: 64  # h, w
padding: 3
supersampling: 4
pixel_center_coordinates_are_integer: false
division_epsilon: 1e-12

# Optimization parameters
learning_rate_lines: 0.1  # lr=1e-1 for lines
learning_rate_curves: 0.05  # lr=0.05 for curves
max_reinit_iter: 100
optimization_iters_n: 100
batch_size: 300  # for processing patches in batches

# Thresholds and probabilities
line_visibility_threshold: 0.5  # 0.5 * h for removed lines
initial_probability: 0.00390625  # 2**-8
width_min_threshold: 0.25  # 1/4
iou_stop_threshold: 0.98  # stop optimization if IOU > 0.98
probability_clip_min: 0.3  # prd < 0.3 = 0

# Iteration intervals
reinit_interval: 20  # reinit every 20 iterations
logging_interval: 20  # log every 20 iterations
snap_interval: 20  # snap lines every 20 iterations

# Energy computation parameters
energy:
  empty_charge: 0
  close_range_weight: 2.0  # 2 * (1 / 0.5)
  elementary_halfwidth: 0.5  # 1 / 2
  visibility_padding: 2
  r_close: 1
  r_far: 32
  far_weight: 0.02  # 1 / 50
  collinearity_beta: 0.0718  # 1 / ((abs(cos(15*pi/180)) - 1)^2)
  collinearity_field_weight: 2